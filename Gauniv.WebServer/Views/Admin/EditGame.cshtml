@model Gauniv.WebServer.Data.Game

@{
    ViewData["Title"] = "Edit Game";
    var categories = ViewBag.Categories as List<Gauniv.WebServer.Data.Category>;
    var selectedCategories = ViewBag.SelectedCategories as List<int>;
}

<div class="container mt-4">
    <h1 class="mb-4">Edit Game: @Model.Name</h1>

    <form asp-action="EditGame" asp-route-id="@Model.Id" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        
        <div class="mb-3">
            <label class="form-label">Game Name</label>
            <input name="Name" class="form-control" value="@Model.Name" />
        </div>

        <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="Description" class="form-control" rows="5">@Model.Description</textarea>
        </div>

        <div class="mb-3">
            <label class="form-label">Price ($)</label>
            <input name="Price" type="number" step="0.01" min="0" class="form-control" value="@Model.Price" />
        </div>

        <div class="mb-3">
            <label class="form-label">Categories</label>
            <div>
                @if (categories != null && categories.Any())
                {
                    foreach (var category in categories)
                    {
                        var isChecked = selectedCategories?.Contains(category.Id) ?? false;
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="CategoryIds" value="@category.Id" 
                                   id="category_@category.Id" @(isChecked ? "checked" : "")>
                            <label class="form-check-label" for="category_@category.Id">
                                @category.Name
                            </label>
                        </div>
                    }
                }
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Current Binary</label>
            @if (!string.IsNullOrEmpty(Model.PayloadPath))
            {
                <p class="text-success"><i class="bi bi-file-check"></i> File uploaded (@(Model.Size / 1024 / 1024) MB)</p>
            }
            else
            {
                <p class="text-muted">No file uploaded</p>
            }
        </div>

        <div class="mb-3">
            <label class="form-label">Replace Game Binary (Optional)</label>
            <input type="file" name="payload" class="form-control" accept=".zip,.rar,.7z,.exe" />
            <small class="form-text text-muted">Leave empty to keep current file</small>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Save Changes
            </button>
            <a asp-action="Games" class="btn btn-secondary">
                <i class="bi bi-x-circle"></i> Cancel
            </a>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
