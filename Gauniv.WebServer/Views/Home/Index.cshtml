@using System.Net
@model Gauniv.WebServer.ViewModels.GamesListViewModel

@{
    ViewData["Title"] = "Tous les jeux";
}

<h1>Tous les jeux</h1>

@if(TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
@if(TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

@{ 
    var categoriesList = Model.Items?.SelectMany(i => i.Categories ?? new List<string>()).Where(c => !string.IsNullOrEmpty(c)).Distinct().OrderBy(c => c).ToList() ?? new List<string>();
    var isOwnedNull = Model.IsOwned == null;
    var isOwnedTrue = Model.IsOwned == true;
    var isOwnedFalse = Model.IsOwned == false;
    var showAdvanced = Model.MinPrice.HasValue || Model.MaxPrice.HasValue || Model.IsOwned != null || Model.MinSize.HasValue || Model.MaxSize.HasValue || (Model.PageSize != 10 && Model.PageSize > 0);

    var selectedCategories = new HashSet<string>(StringComparer.OrdinalIgnoreCase);
    if (!string.IsNullOrWhiteSpace(Model.Category))
    {
        foreach (var s in Model.Category.Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries))
        {
            var t = s.Trim();
            if (!string.IsNullOrEmpty(t)) selectedCategories.Add(t);
        }
    }
}

@{
    ViewData["BaseUrl"] = Url.Action("Index","Home");
}
@await Html.PartialAsync("~/Views/Shared/_GamesFilters.cshtml", Model)

@await Html.PartialAsync("_GamesCards", Model)

@if (!Model.Items.Any())
{
    <div class="alert alert-info mt-3">
        <i class="bi bi-info-circle"></i> Aucun jeu trouv√©.
    </div>
}
